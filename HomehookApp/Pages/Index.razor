@page "/"

<h1>Homehook Cast</h1>

@if (_receiverHub == null || _receiverHub.State != HubConnectionState.Connected)
{
    <BusyCover />
}
else
{
    <div class="d-flex flex-wrap">
        @foreach (string receiver  in _receivers)
        {
            <Receiver Name=@receiver />
        }
    </div>
}


@code{

    private IEnumerable<string> _receivers;
    private HubConnection _receiverHub;

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();

        _receiverHub = new HubConnectionBuilder()
            .WithUrl(new Uri("http://localhost:5000/receiverhub"))
            .AddNewtonsoftJsonProtocol()
            .WithAutomaticReconnect()
            .Build();

        await _receiverHub.StartAsync();

        _receivers = await _receiverHub.InvokeAsync<IEnumerable<string>>("GetReceivers");

    }

}
